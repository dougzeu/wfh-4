<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIWFHT - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent': '#a7ee43',
                        'accent-green': '#A7EE43',
                        'black': '#080F17',
                        'white': '#D6DDE6',
                        'transparent-3': '#D6DDE6'
                    },
                    fontFamily: {
                        'jakarta': ['Plus Jakarta Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        /* Toast notification styles */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            min-width: 300px;
            max-width: 90vw;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            background: #A7EE43;
            color: #080F17;
        }
        .toast.error {
            background: #ef4444;
            color: white;
        }
        .toast.warning {
            background: #f59e0b;
            color: white;
        }
        
        /* Loading spinner */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Focus styles for accessibility */
        .day-selector:focus {
            outline: 2px solid #A7EE43;
            outline-offset: 2px;
        }
        
        /* Selection counter pulse animation */
        .selection-counter.updated {
            animation: pulse 0.3s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Improved mobile responsive styles */
        @media (max-width: 640px) {
            .day-selector-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .day-selector-grid .day-selector:nth-child(5) {
                grid-column: 1 / -1;
                max-width: 50%;
                margin: 0 auto;
            }
        }
        
        @media (min-width: 641px) {
            .day-selector-grid {
                display: flex;
                gap: 0.75rem;
                justify-content: center;
            }
        }
    </style>
</head>
<body class="bg-black min-h-screen font-jakarta">
    <!-- Skip to main content for screen readers -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-accent text-black px-4 py-2 rounded z-50">
        Skip to main content
    </a>

    <!-- Toast Notification Container -->
    <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-description">
        <div class="bg-black border border-white/20 rounded-lg p-6 max-w-md mx-4">
            <h3 id="modal-title" class="text-white font-semibold text-lg mb-2">Confirm Week Change</h3>
            <p id="modal-description" class="text-white/80 text-sm mb-4">You have unsaved selections. Changing weeks will clear your current selections. Continue?</p>
            <div class="flex gap-3 justify-end">
                <button id="modal-cancel" class="
                    px-4 py-2 text-white/80 hover:text-white 
                    transition-colors min-h-[44px]
                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                ">Cancel</button>
                <button id="modal-confirm" class="
                    px-4 py-2 bg-accent text-black rounded 
                    hover:bg-accent/90 transition-colors min-h-[44px]
                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                ">Continue</button>
            </div>
        </div>
    </div>

    <div class="relative size-full min-h-screen">
        <div class="min-h-inherit relative size-full">
            <div class="
                flex flex-col-reverse items-start justify-start 
                min-h-inherit px-4 sm:px-8 lg:px-12 py-0 
                relative size-full
            ">
                
                <!-- Header -->
                <header class="bg-black order-3 relative shrink-0 w-full" role="banner">
                    <div class="flex flex-row items-center relative size-full">
                        <div class="
                            flex flex-row items-center justify-between 
                            px-0 py-3 
                            relative w-full
                        ">
                            <!-- Logo -->
                            <div class="h-8 relative shrink-0">
                                <div class="
                                    flex flex-row gap-1.5 h-8 items-center justify-start 
                                    p-0 relative
                                ">
                                    <div class="relative shrink-0 size-8">
                                        <svg class="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 32 32" aria-hidden="true">
                                            <path d="M10.6667 18.6667C10.6667 18.6667 12.6667 21.3333 16 21.3333C19.3333 21.3333 21.3333 18.6667 21.3333 18.6667M22.6667 12.32C22.14 12.9667 21.42 13.3333 20.6667 13.3333C19.9133 13.3333 19.2133 12.9667 18.6667 12.32M13.3333 12.32C12.8067 12.9667 12.0867 13.3333 11.3333 13.3333C10.58 13.3333 9.88 12.9667 9.33333 12.32M29.3333 16C29.3333 23.3638 23.3638 29.3333 16 29.3333C8.6362 29.3333 2.66667 23.3638 2.66667 16C2.66667 8.6362 8.6362 2.66667 16 2.66667C23.3638 2.66667 29.3333 8.6362 29.3333 16Z" stroke="#A7EE43" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"/>
                                        </svg>
                                    </div>
                                    <div class="
                                        font-bold leading-[0] relative shrink-0 
                                        text-accent text-lg sm:text-xl lg:text-[24px] 
                                        text-left text-nowrap tracking-[-0.72px]
                                    ">
                                        <p class="block leading-none whitespace-pre">FIWFHT</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- User Info -->
                            <div class="relative shrink-0">
                                <div class="
                                    flex flex-row gap-2 items-center justify-end 
                                    p-0 relative
                                ">
                                    <div class="
                                        font-medium leading-[0] relative shrink-0 
                                        text-white text-sm lg:text-[15px] text-left text-nowrap
                                    " id="user-name">
                                        <p class="block leading-[20px] whitespace-pre">{{ userName }}</p>
                                    </div>
                                    <button class="
                                        relative size-10 shrink-0 flex items-center justify-center 
                                        hover:bg-white/10 rounded transition-colors
                                        focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                                    " title="Logout" aria-label="Logout">
                                        <svg class="block size-6" fill="none" preserveAspectRatio="none" viewBox="0 0 24 24" aria-hidden="true">
                                            <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="#D6DDE6" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Divider -->
                            <div class="absolute bottom-0 h-0 left-[-48px] sm:left-[-96px] right-[-48px] sm:right-[-96px]">
                                <div class="absolute bottom-[-0.75px] left-0 right-0 top-[-0.75px]">
                                    <svg class="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 1536 2" aria-hidden="true">
                                        <path d="M0 1H1536" stroke="#D6DDE6" stroke-opacity="0.2" stroke-width="1.5"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Content -->
                <main class="order-2 relative shrink-0 w-full" id="main-content" role="main">
                    <div class="relative size-full">
                        <div class="
                            flex flex-col-reverse items-start justify-start 
                            px-0 py-6 sm:py-12 
                            relative w-full
                        ">
                            
                            <!-- Work From Home Section -->
                            <section class="bg-black relative shrink-0 w-full order-2" aria-labelledby="wfh-heading">
                                <div class="flex flex-col items-center relative size-full">
                                    <div class="
                                        flex flex-col gap-6 sm:gap-8 items-center justify-start 
                                        px-0 py-8 sm:py-16 
                                        relative w-full max-w-6xl
                                    ">
                                        
                                        <!-- Date Navigation -->
                                        <nav class="relative shrink-0" aria-label="Week navigation">
                                            <div class="
                                                flex flex-row gap-3 items-center justify-start 
                                                p-0 relative
                                            ">
                                                <button class="
                                                    flex items-center justify-center relative shrink-0 
                                                    hover:bg-[rgba(255,255,255,0.1)] p-2 rounded transition-colors 
                                                    size-10
                                                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                                                " id="prevWeek" aria-label="Previous week">
                                                    <div class="flex-none rotate-[180deg] scale-y-[-100%]">
                                                        <svg class="relative size-6" fill="none" preserveAspectRatio="none" viewBox="0 0 24 24" aria-hidden="true">
                                                            <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="#D6DDE6" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"/>
                                                        </svg>
                                                    </div>
                                                </button>
                                                <div class="relative shrink-0 size-6">
                                                    <svg class="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 24 24" aria-hidden="true">
                                                        <path d="M16 2V6M8 2V6M3 10H21M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z" stroke="#D6DDE6" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"/>
                                                    </svg>
                                                </div>
                                                <div class="
                                                    font-medium leading-[0] relative shrink-0 
                                                    text-white text-sm lg:text-[15px] text-left text-nowrap
                                                ">
                                                    <p class="block leading-[20px] whitespace-pre" id="weekRange">May 25 - 30, 2025</p>
                                                </div>
                                                <button class="
                                                    relative size-10 shrink-0 flex items-center justify-center
                                                    hover:bg-[rgba(255,255,255,0.1)] p-2 rounded transition-colors 
                                                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                                                " id="nextWeek" aria-label="Next week">
                                                    <svg class="block size-6" fill="none" preserveAspectRatio="none" viewBox="0 0 24 24" aria-hidden="true">
                                                        <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="#D6DDE6" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </nav>

                                        <!-- Section Title -->
                                        <div class="relative shrink-0 w-full">
                                            <div class="
                                                flex flex-col gap-2 items-center justify-start 
                                                leading-[0] p-0 relative text-white text-center w-full
                                            ">
                                                <h1 id="wfh-heading" class="
                                                    font-bold relative shrink-0 
                                                    text-xl sm:text-2xl lg:text-[28px] 
                                                    tracking-[-0.28px] max-w-full px-4
                                                ">
                                                    <span class="block leading-[32px]">Choose up to 2 days per week to work from home.</span>
                                                </h1>
                                                <p class="
                                                    font-normal relative shrink-0 
                                                    text-xs sm:text-sm text-nowrap
                                                ">
                                                    <span class="block leading-[20px] whitespace-pre">The next week will be set automatically, but you can adjust your days anytime.</span>
                                                </p>
                                            </div>
                                        </div>

                                        <!-- Selection Counter -->
                                        <div class="relative shrink-0">
                                            <div class="selection-counter font-medium text-white/80 text-sm" id="selection-counter">
                                                <span id="selected-count">1</span>/2 days selected
                                            </div>
                                        </div>

                                        <!-- Days Selection -->
                                        <div class="relative shrink-0 w-full max-w-4xl">
                                            <div class="day-selector-grid" role="group" aria-label="Select work from home days" id="day-selector-container">
                                                <!-- Day buttons will be generated by JavaScript -->
                                            </div>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div class="
                                            flex flex-col sm:flex-row gap-3 items-center justify-center 
                                            w-full max-w-md
                                        ">
                                            <button 
                                                id="saveButton"
                                                class="
                                                    bg-accent text-black font-semibold
                                                    px-6 py-3 rounded-lg
                                                    hover:bg-accent/90 transition-colors
                                                    min-h-[44px] w-full sm:w-auto
                                                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                                                    disabled:opacity-50 disabled:cursor-not-allowed
                                                "
                                            >
                                                <div class="flex items-center justify-center gap-2">
                                                    <div id="saveSpinner" class="spinner hidden"></div>
                                                    <span id="saveButtonText">Save Schedule</span>
                                                </div>
                                            </button>
                                            <button 
                                                id="clearButton"
                                                class="
                                                    bg-transparent text-white/80 font-medium border border-white/20
                                                    px-6 py-3 rounded-lg
                                                    hover:bg-white/10 hover:text-white transition-colors
                                                    min-h-[44px] w-full sm:w-auto
                                                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                                                "
                                            >
                                                Clear All
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Who's in the Office Section -->
                            <section class="bg-black relative shrink-0 w-full order-1" aria-labelledby="office-heading">
                                <div class="flex flex-col items-center relative size-full">
                                    <div class="
                                        flex flex-col gap-6 sm:gap-8 items-center justify-start 
                                        px-0 py-8 sm:py-16 
                                        relative w-full max-w-6xl
                                    ">
                                        
                                        <!-- Section Title -->
                                        <div class="relative shrink-0 w-full">
                                            <div class="
                                                flex flex-col gap-2 items-center justify-start 
                                                leading-[0] p-0 relative text-white text-center w-full
                                            ">
                                                <h2 id="office-heading" class="
                                                    font-bold relative shrink-0 
                                                    text-xl sm:text-2xl lg:text-[28px] 
                                                    tracking-[-0.28px] max-w-full
                                                ">
                                                    <span class="block leading-[32px]">Who's in the office this week?</span>
                                                </h2>
                                            </div>
                                        </div>

                                        <!-- Employee List -->
                                        <div class="relative shrink-0 w-full">
                                            <div class="
                                                grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 
                                                gap-4 w-full max-w-6xl
                                            " id="employee-list">
                                                <!-- Employee cards will be generated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Divider -->
                                <div class="absolute bottom-0 h-0 left-[-48px] sm:left-[-96px] right-[-48px] sm:right-[-96px]">
                                    <div class="absolute bottom-[-0.75px] left-0 right-0 top-[-0.75px]">
                                        <svg class="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 1536 2" aria-hidden="true">
                                            <path d="M0 1H1536" stroke="#D6DDE6" stroke-opacity="0.2" stroke-width="1.5"/>
                                        </svg>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </main>

                <!-- Footer -->
                <div class="bg-black h-12 order-1 shrink-0 w-full"></div>
            </div>
        </div>
    </div>

    <script>
        // Employee data (extracted from hardcoded HTML)
        const OFFICE_EMPLOYEES = [
            { name: 'Sophia Turner', email: 'sophia@healthboost.com' },
            { name: 'Michael Chen', email: 'michael@fitlife.com' },
            { name: 'Emma Johnson', email: 'emma@activelife.com' },
            { name: 'Liam Rodriguez', email: 'liam@performanceplus.com' },
            { name: 'Olivia Martin', email: 'olivia@vitalityhub.com' },
            { name: 'James Smith', email: 'james@powerup.com' },
            { name: 'Ava Brown', email: 'ava@dynamicfitness.com' },
            { name: 'Elijah Davis', email: 'elijah@strengthzone.com' },
            { name: 'Mia Wilson', email: 'mia@trainhard.com' },
            { name: 'Noah Garcia', email: 'noah@wellbeing.com' },
            { name: 'Isabella Lopez', email: 'isabella@moveforward.com' },
            { name: 'Lucas Taylor', email: 'lucas@totalfit.com' },
            { name: 'Charlotte Anderson', email: 'charlotte@energize.com' },
            { name: 'Benjamin Thomas', email: 'benjamin@revitalize.com' }
        ];

        // Global variables
        function getCurrentWeekStart() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const monday = new Date(today);
            // Calculate days back to Monday (1 = Monday)
            const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
            monday.setDate(today.getDate() - daysToMonday);
            return monday;
        }
        
        let currentWeekStart = getCurrentWeekStart(); // Start from current week
        let selectedDays = ['tuesday']; // Initially Tuesday is selected
        let hasUnsavedChanges = false;
        const maxSelections = 2;
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const weekdays = [
            { key: 'monday', name: 'Monday', short: 'Mon' },
            { key: 'tuesday', name: 'Tuesday', short: 'Tue' },
            { key: 'wednesday', name: 'Wednesday', short: 'Wed' },
            { key: 'thursday', name: 'Thursday', short: 'Thu' },
            { key: 'friday', name: 'Friday', short: 'Fri' }
        ];
        
        // Storage keys
        const STORAGE_KEYS = {
            SELECTIONS: 'wfh_selections',
            CURRENT_WEEK: 'wfh_current_week'
        };

        // Utility Functions
        function showToast(message, type = 'success', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type} rounded-lg p-4 mb-2 shadow-lg`;
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="
                        ml-2 text-current opacity-70 hover:opacity-100 
                        size-6 flex items-center justify-center
                        focus:outline-none focus:ring-1 focus:ring-current
                    " aria-label="Close notification">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        }

        function showConfirmationModal(message, onConfirm) {
            const modal = document.getElementById('confirmation-modal');
            const confirmBtn = document.getElementById('modal-confirm');
            const cancelBtn = document.getElementById('modal-cancel');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Set focus to cancel button for better UX
            cancelBtn.focus();
            
            const handleConfirm = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                onConfirm();
                cleanup();
            };
            
            const handleCancel = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                cleanup();
            };
            
            const cleanup = () => {
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
                document.removeEventListener('keydown', handleEscape);
            };
            
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    handleCancel();
                }
            };
            
            confirmBtn.addEventListener('click', handleConfirm);
            cancelBtn.addEventListener('click', handleCancel);
            document.addEventListener('keydown', handleEscape);
        }

        // Local Storage Functions
        function saveToLocalStorage() {
            const weekKey = getWeekKey(currentWeekStart);
            const data = {
                selectedDays: selectedDays,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem(`${STORAGE_KEYS.SELECTIONS}_${weekKey}`, JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const weekKey = getWeekKey(currentWeekStart);
            const data = localStorage.getItem(`${STORAGE_KEYS.SELECTIONS}_${weekKey}`);
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    selectedDays = parsed.selectedDays || [];
                    return true;
                } catch (e) {
                    console.warn('Failed to parse saved data', e);
                }
            }
            return false;
        }

        function getWeekKey(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const day = date.getDate();
            return `${year}-${month}-${day}`;
        }

        // UI Update Functions
        function updateWeekDisplay() {
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 4); // Friday
            
            const startMonth = months[currentWeekStart.getMonth()];
            const endMonth = months[weekEnd.getMonth()];
            const startDay = currentWeekStart.getDate();
            const endDay = weekEnd.getDate();
            const year = currentWeekStart.getFullYear();
            
            let displayText;
            if (startMonth === endMonth) {
                displayText = `${startMonth} ${startDay} - ${endDay}, ${year}`;
            } else {
                displayText = `${startMonth} ${startDay} - ${endMonth} ${endDay}, ${year}`;
            }
            
            document.getElementById('weekRange').textContent = displayText;
            updateDayButtons();
        }

        function updateDayButtons() {
            const container = document.getElementById('day-selector-container');
            const currentDate = new Date(currentWeekStart);
            
            container.innerHTML = '';
            
            weekdays.forEach((dayInfo, index) => {
                const dayDate = new Date(currentDate);
                dayDate.setDate(currentDate.getDate() + index);
                
                const isSelected = selectedDays.includes(dayInfo.key);
                
                const button = document.createElement('button');
                button.className = `
                    relative rounded-lg shrink-0 w-full min-w-[100px] sm:w-[108px]
                    min-h-[80px] sm:min-h-[88px]
                    border-[1.5px] transition-colors day-selector
                    focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-black
                    ${isSelected 
                        ? 'bg-accent text-black border-accent' 
                        : 'bg-black text-white border-[rgba(214,221,230,0.2)] hover:bg-[rgba(255,255,255,0.04)]'
                    }
                `;
                
                button.setAttribute('data-day', dayInfo.key);
                button.setAttribute('data-date', dayDate.getDate());
                button.setAttribute('role', 'button');
                button.setAttribute('tabindex', '0');
                button.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
                button.setAttribute('aria-label', `${dayInfo.name}, ${months[dayDate.getMonth()]} ${dayDate.getDate()}${isSelected ? ' - Selected' : ''}`);
                
                button.innerHTML = `
                    <div class="flex flex-col items-center justify-center relative size-full">
                        <div class="
                            flex flex-col gap-2 sm:gap-3 items-center justify-center 
                            leading-[0] px-3 py-4 relative text-center w-full
                        ">
                            <div class="font-semibold relative shrink-0 text-[11px] sm:text-[13px]">
                                <span class="block leading-[16px] text-nowrap whitespace-pre">${dayInfo.name}</span>
                            </div>
                            <div class="font-medium relative shrink-0 text-lg sm:text-[22px]">
                                <span class="block leading-[20px] text-nowrap whitespace-pre">${dayDate.getDate()}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(button);
            });
        }

        function updateSelectionCounter() {
            const counter = document.getElementById('selection-counter');
            const countElement = document.getElementById('selected-count');
            
            countElement.textContent = selectedDays.length;
            counter.classList.add('updated');
            
            setTimeout(() => {
                counter.classList.remove('updated');
            }, 300);
        }

        function updateSaveButtonState() {
            const saveButton = document.getElementById('saveButton');
            const saveButtonText = document.getElementById('saveButtonText');
            
            if (selectedDays.length === 0) {
                saveButton.disabled = true;
                saveButtonText.textContent = 'Select Days First';
            } else if (!hasUnsavedChanges) {
                saveButton.disabled = true;
                saveButtonText.textContent = 'Saved';
            } else {
                saveButton.disabled = false;
                saveButtonText.textContent = 'Save Schedule';
            }
        }

        // Employee List Rendering
        function renderEmployeeList() {
            const container = document.getElementById('employee-list');
            container.innerHTML = OFFICE_EMPLOYEES.map(emp => `
                <div class="
                    bg-black rounded-lg border border-white/20 
                    p-3 hover:bg-white/5 transition-colors
                ">
                    <div class="flex gap-3 items-center">
                        <div class="font-medium text-white text-sm sm:text-[15px] truncate">
                            ${emp.name}
                        </div>
                        <div class="font-semibold text-xs text-white/40 truncate">
                            ${emp.email}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Day Selector Functionality
        function setSelectedDayStyles(button) {
            button.className = button.className.replace(/bg-black|border-\[rgba\(214,221,230,0\.2\)\]|text-white/g, '');
            button.className += ' bg-accent text-black border-accent';
            button.setAttribute('aria-pressed', 'true');
            
            const label = button.getAttribute('aria-label');
            if (!label.includes('Selected')) {
                button.setAttribute('aria-label', label + ' - Selected');
            }
        }

        function resetDayStyles(button) {
            button.className = button.className.replace(/bg-accent|text-black|border-accent/g, '');
            button.className += ' bg-black text-white border-[rgba(214,221,230,0.2)] hover:bg-[rgba(255,255,255,0.04)]';
            button.setAttribute('aria-pressed', 'false');
            
            const label = button.getAttribute('aria-label');
            button.setAttribute('aria-label', label.replace(' - Selected', ''));
        }

        function updateDaySelector(button, day) {
            const isSelected = selectedDays.includes(day);
            
            if (isSelected) {
                // Deselect
                selectedDays = selectedDays.filter(d => d !== day);
                resetDayStyles(button);
                hasUnsavedChanges = true;
                showToast(`${day.charAt(0).toUpperCase() + day.slice(1)} deselected`, 'warning', 2000);
            } else {
                // Select (if under limit)
                if (selectedDays.length < maxSelections) {
                    selectedDays.push(day);
                    setSelectedDayStyles(button);
                    hasUnsavedChanges = true;
                    showToast(`${day.charAt(0).toUpperCase() + day.slice(1)} selected for WFH`, 'success', 2000);
                } else {
                    showToast('You can only select up to 2 days per week to work from home.', 'error', 4000);
                    return;
                }
            }
            
            updateSelectionCounter();
            updateSaveButtonState();
            saveToLocalStorage(); // Auto-save draft
        }

        // Date navigation functionality
        function changeWeek(direction) {
            const attemptChange = () => {
                const newWeekStart = new Date(currentWeekStart);
                newWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
                currentWeekStart = newWeekStart;
                
                // Reset selections when changing weeks
                selectedDays = [];
                
                hasUnsavedChanges = false;
                updateWeekDisplay();
                loadFromLocalStorage(); // Try to load saved selections for this week
                
                updateWeekDisplay(); // Update again with loaded data
                updateSelectionCounter();
                updateSaveButtonState();
                showToast(`Switched to ${direction > 0 ? 'next' : 'previous'} week`, 'success', 2000);
            };
            
            if (hasUnsavedChanges && selectedDays.length > 0) {
                showConfirmationModal(
                    'You have unsaved selections. Changing weeks will clear your current selections. Continue?',
                    attemptChange
                );
            } else {
                attemptChange();
            }
        }

        function clearAllSelections() {
            if (selectedDays.length === 0) {
                showToast('No selections to clear', 'warning', 2000);
                return;
            }
            
            selectedDays = [];
            updateDayButtons();
            
            hasUnsavedChanges = true;
            updateSelectionCounter();
            updateSaveButtonState();
            saveToLocalStorage();
            showToast('All selections cleared', 'success', 2000);
        }

        // Enhanced save functionality
        async function saveSchedule() {
            if (selectedDays.length === 0) {
                showToast('Please select at least one day to work from home.', 'error', 3000);
                return;
            }

            const saveButton = document.getElementById('saveButton');
            const saveSpinner = document.getElementById('saveSpinner');
            const saveButtonText = document.getElementById('saveButtonText');
            
            // Show loading state
            saveButton.disabled = true;
            saveSpinner.classList.remove('hidden');
            saveButtonText.textContent = 'Saving...';
            
            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const dayNames = selectedDays.map(day => day.charAt(0).toUpperCase() + day.slice(1));
                hasUnsavedChanges = false;
                
                showToast(`Schedule saved! WFH days: ${dayNames.join(', ')}`, 'success', 4000);
                
                // Save final state
                saveToLocalStorage();
                
            } catch (error) {
                showToast('Failed to save schedule. Please try again.', 'error', 4000);
            } finally {
                // Hide loading state
                saveSpinner.classList.add('hidden');
                updateSaveButtonState();
            }
        }

        // Keyboard navigation
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', (e) => {
                const focusedElement = document.activeElement;
                
                if (focusedElement && focusedElement.classList.contains('day-selector')) {
                    const buttons = Array.from(document.querySelectorAll('.day-selector'));
                    const currentIndex = buttons.indexOf(focusedElement);
                    
                    switch(e.key) {
                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            focusedElement.click();
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            if (currentIndex > 0) buttons[currentIndex - 1].focus();
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            if (currentIndex < buttons.length - 1) buttons[currentIndex + 1].focus();
                            break;
                        case 'Home':
                            e.preventDefault();
                            buttons[0].focus();
                            break;
                        case 'End':
                            e.preventDefault();
                            buttons[buttons.length - 1].focus();
                            break;
                    }
                }
            });
        }

        // Event listeners
        function setupEventListeners() {
            // Day selectors (delegated event handling)
            document.getElementById('day-selector-container').addEventListener('click', function(e) {
                const button = e.target.closest('.day-selector');
                if (button) {
                    const day = button.getAttribute('data-day');
                    updateDaySelector(button, day);
                }
            });

            // Date navigation buttons
            document.getElementById('prevWeek').addEventListener('click', () => changeWeek(-1));
            document.getElementById('nextWeek').addEventListener('click', () => changeWeek(1));

            // Action buttons
            document.getElementById('saveButton').addEventListener('click', saveSchedule);
            document.getElementById('clearButton').addEventListener('click', clearAllSelections);
            
            // Logout button
            document.querySelector('[aria-label="Logout"]').addEventListener('click', () => {
                localStorage.clear();
                window.location.href = 'index.html';
            });
        }

        // Initialize the application
        function init() {
            // Load user data
            const userName = localStorage.getItem('userName') || 'User';
            document.getElementById('user-name').querySelector('p').textContent = userName;
            
            // Load saved data
            loadFromLocalStorage();
            
            // Render initial UI
            updateWeekDisplay();
            renderEmployeeList();
            updateSelectionCounter();
            updateSaveButtonState();
            
            // Setup interactions
            setupEventListeners();
            setupKeyboardNavigation();
            
            // Show welcome message
            setTimeout(() => {
                showToast('Welcome! Select your work from home days for the week.', 'success', 3000);
            }, 500);
        }

        // Run when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 